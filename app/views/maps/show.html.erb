<h1><%= @map.map_title %></h1>

<script>
  var lat = <%=  @map.middle_ground_lat %>;
  var lon = <%= @map.middle_ground_long %>;
  var bounds = new google.maps.LatLngBounds();

  function addAllMarkers(){  
    <% @map.addresses.each do |address| %>
      var lat = <%= address.latitude %>;
      var lon = <%= address.longitude %>;
      var loc = new google.maps.LatLng(lat,lon);
      var newMark = new google.maps.Marker({
        position: loc, 
        map:map
      }); 
      bounds.extend(loc);
    <% end %>

    if (bounds.isEmpty() == false){
      map.fitBounds(bounds);
      map.panToBounds(bounds);
    }
  }

  google.maps.event.addDomListener(window, "load", initialize);

  google.maps.event.addDomListener(window, "load", addAllMarkers);
  
  var start = new google.maps.LatLng(<%= @map.addresses[0].latitude %>, <%= @map.addresses[0].longitude %>);
  var end = new google.maps.LatLng(<%= @map.addresses[1].latitude %>, <%= @map.addresses[1].longitude %>);

  window.onload = function () {
    var calcBtn = document.getElementById("btn");
    
    calcBtn.addEventListener("click", function() {
      calcRoute(start, end);
    });
  }

</script>
  

<div id="googleMap" style="width:800px;height:380px;"></div>
<%= render "address_form" %>

<div class="address_list">
  <ul>
    <% @map.addresses.each do |address| %>
      <% next if address.id.nil? %>
      <li><%= address.name %>: <%= address.place %> <%= link_to "Delete", map_address_path(address.map_id, address.id), :confirm => "Are you sure you want to delete this attachment?", :method => :delete %></li>
    <% end %>
  </ul>
</div>

<button id="btn">Calculate Route</button>

<br>
<%= link_to "Back to all maps", maps_path %>
